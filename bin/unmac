#!/usr/bin/env ruby

require 'getoptlong'
require 'rubygems'
require 'unmacer'

def usage
  puts "unmac [-h|--help] [-v|--verbose] [-t|--keep-trashes] [-o|--keep-apple-double-orphans] directory ..."
end

opts = GetoptLong.new(
  ['--help',                      '-h', GetoptLong::NO_ARGUMENT],
  ['--verbose',                   '-v', GetoptLong::NO_ARGUMENT],
  ['--keep-trashes',              '-t', GetoptLong::NO_ARGUMENT],
  ['--keep-apple-double-orphans', '-o', GetoptLong::NO_ARGUMENT]
)

begin
  unmacer = Unmacer.new
  opts.each do |opt, val|
    case opt
    when '--help'
      usage and exit
    when '--verbose'
      unmacer.verbose = true
    when '--keep-trashes'
      unmacer.keep_trashes = true
    when '--keep-apple-double-orphans'
      unmacer.keep_apple_double_orphans = true
    end
  end
  puts ARGV.join(', ')
  exit
  unmacer.unmac!(ARGV)
rescue GetoptLong::InvalidOption
  usage and exit 1
end